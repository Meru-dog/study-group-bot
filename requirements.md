# 勉強会運用 Slack連携アプリ（MVP）要件定義書（最終版）

## 1. 目的

Slack上の操作（リアクション＋スレッド返信）だけで、勉強会の

* 出席（対面/オンライン/欠席）
* 発表者（先着2名）
* 発表テーマ
  を自己申告で確定し、**Googleスプレッドシートに自動記録して正本化**する。
  主催者の集計・把握コストをゼロに近づけ、運用を非中央集権化する。

---

## 2. 前提

* 開催：月水金 17:00–19:00（渋谷＋Google Meet）
* Meet固定URLは存在する
* Slack無料プラン前提（Workflow Builderは使用しない）
* SlackはUI、スプシが履歴の正本（Slack履歴制限に依存しない）
* 欠席の場合もスプシに**必ず行を作成**し、履歴・出席率集計の分母を安定させる

---

## 3. Slack上の入力仕様（参加者の操作）

### 3.1 参加形態（必須：いずれか1つ）

* ✅：対面
* 💻：オンライン
* 💤：欠席

**ルール**

* ✅/💻/💤 のうち **いずれか1つが有効**
* 押し直しで変更可能
  → **最後に押した参加形態が正**（上書き）

### 3.2 発表希望（任意：追加で押せる）

* 🎤：発表希望

**ルール**

* 🎤は参加形態とは独立（✅/💻/💤を上書きしない）
* 発表枠は2名（先着）
* 🎤を外したら取消として反映し、枠が空けば繰り上げ

### 3.3 発表テーマ（MVPに含める）

* 発表者（🎤で発表枠に入った人）は、**参加宣言メッセージのスレッドに返信**でテーマを送る

**書式**

* 返信本文の先頭に `テーマ：` を付ける
  例：`テーマ：開示規制について`

**ルール**

* 同一発表者が複数回投稿した場合、**最新のテーマを正**として上書き
* 発表者でない人のテーマ返信は反映しない（無視）

---

## 4. 時刻設計（投稿・締切・通知）

### 4.1 参加宣言メッセージ投稿

* Botは開催日（月水金）の **9:00** に #attendance に参加宣言メッセージを投稿する

### 4.2 一次確定（締切）

* **当日 15:00** を一次確定時刻とする（サマリ投稿）

### 4.3 遅刻参加の扱い

* 15:00以降もリアクション更新を許容し、スプシは更新される
* MVPでは「更新サマリ」を自動投稿するかは任意（**MVPでは省略可**）

### 4.4 開始通知

* **17:00** に開始通知を #attendance に投稿し、**@channel** を付ける
* 固定Meet URLを必ず含める

---

## 5. Bot機能要件（MVP）

### 5.1 参加宣言メッセージ生成

**FR-1**：Botは当日9:00に #attendance へ参加宣言メッセージを投稿する。
**FR-2**：メッセージには以下を必ず含める：

* 開催日
* 締切（15:00）
* リアクションの意味（✅/💻/💤/🎤）
* テーマ投稿方法（スレッド返信「テーマ：〜」）
* Meet固定URL

### 5.2 リアクション処理（参加形態）

**FR-3**：Botは参加宣言メッセージへの ✅/💻/💤 を受け取り、参加形態を確定する。
**FR-4**：✅/💻/💤 が複数押された場合、**最後の参加形態を正**として更新する。

### 5.3 リアクション処理（発表者）

**FR-5**：Botは🎤リアクションを発表希望として記録し、希望者を時刻順に並べる。
**FR-6**：上位2名を発表者として確定する（先着2名）。
**FR-7**：🎤を外した場合、取消として反映し、発表者順位を再計算して繰り上げる。
**FR-8**：🎤は参加形態を変更しない（上書きしない）。

### 5.4 スレッド返信処理（発表テーマ）

**FR-9**：Botは参加宣言メッセージのスレッド返信を監視する。
**FR-10**：返信が `テーマ：` で始まり、投稿者が発表者（発表枠内）である場合、スプシの「発表テーマ」を更新する。
**FR-11**：同一発表者が複数テーマを送った場合、最新を正として上書きする。
**FR-12**：発表者でない人のテーマ返信はスプシに反映しない。

### 5.5 一次確定サマリ（15:00）

**FR-13**：15:00に #attendance へ一次確定サマリを投稿する。
**FR-14**：サマリには以下を含める：

* 対面参加者一覧
* オンライン参加者一覧
* 欠席者一覧（または人数）
* 発表者2名（対面/オンライン別つき）
* 発表テーマ（入力済みなら表示）
* Meet固定URL

### 5.6 開始通知（17:00）

**FR-15**：17:00に #attendance へ **@channel** 付きで開始通知を投稿する。
**FR-16**：開始通知には必ず以下を含める：

* Meet固定URL
* 発表者2名（参加形態つき）
* 発表テーマ（入力済みなら表示）

---

## 6. Googleスプレッドシート要件（正本DB）

### 6.1 シート名

* `出席管理`（名称は任意、列は固定）

### 6.2 必須カラム（確定）

あなたの提示例を**そのまま採用**し、列名も固定する。

| 列名       | 内容       | 値の例             |
| -------- | -------- | --------------- |
| 日付       | 開催日      | 2026/02/06      |
| 参加者      | Slack表示名 | 法務太郎            |
| 対面/オンライン | 参加形態     | 対面 / オンライン / 欠席 |
| 発表の有無    | 発表者か     | ○ / （空欄）        |
| 発表テーマ    | テーマ      | 開示規制について / （空欄） |

### 6.3 レコード作成・更新ルール（欠席も行を作る）

**DR-1**：key = `日付 + 参加者` とし、同一日に同一参加者は1行。
**DR-2**：✅/💻/💤 のいずれかの入力があった時点で **必ず行を作成（欠席も含む）**。
**DR-3**：参加形態は最後の✅/💻/💤で上書き。
**DR-4**：発表枠内（先着2名）なら「発表の有無＝○」、枠外なら空欄。
**DR-5**：発表テーマは `テーマ：` 返信の最新で上書き。未入力なら空欄。

> 注：Slack表示名の揺れが将来問題になった場合に備え、将来拡張として `SlackユーザーID` 列を追加できるようにしておく（MVPでは必須にしない）

---

## 7. 参加宣言メッセージ（MVP用：文面案）

**タイトル**

* `【本日 勉強会】参加宣言（締切15:00）`

**本文**

* 本日 17:00–19:00 勉強会（渋谷＋Meet）です。
* **15:00までに**この投稿にリアクションで参加宣言してください：

  * ✅ 対面（渋谷）
  * 💻 オンライン（Meet）
  * 💤 欠席
* 発表したい人は **🎤** を追加で押してください（先着2名／取り消しは🎤を外す）
* 発表者はスレッドに `テーマ：〇〇` と返信してください（後で変更OK）
* Meet：＜固定URL＞

---

## 8. 受入基準（Acceptance Criteria）

1. **9:00** に参加宣言メッセージが投稿される（Meet URL含む）
2. ✅/💻/💤で「対面/オンライン/欠席」がスプシに反映され、押し直しで更新される
3. **欠席（💤）でも必ずスプシに行が作成**される
4. 🎤で発表希望が記録され、先着2名が「発表の有無＝○」となる
5. 🎤を外すと取消が反映され、発表枠が繰り上がり、スプシも更新される
6. 発表者がスレッドに `テーマ：...` と返信すると「発表テーマ」に自動反映され、再投稿で上書きされる
7. **15:00** に一次確定サマリが投稿され（Meet URL・発表者・テーマ・参加形態が判別可能）
8. **17:00** に **@channel** 付き開始通知が投稿され、Meet URL と発表者（テーマ付き）が含まれる